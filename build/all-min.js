var MEPS,countries=[];angular.module("eu",["ui.router","ngMaterial","countrySelect","ngSanitize","dossier","mep","vote","cal","jsonFormatter","infinite-scroll"]).value("countries",{Germany:"de",Belgium:"be","Czech Republic":"cz","United Kingdom":"gb",Malta:"ma",France:"fr",Netherlands:"nl",Spain:"es",Poland:"pl",Portugal:"pt",Italy:"it",Ireland:"ir",Austria:"at",Sweden:"se",Hungary:"hu",Latvia:"lv",Finland:"fi",Bulgaria:"bg",Lithuania:"lt",Slovenia:"sl",Denmark:"dm",Greece:"gr",Slovakia:"sk",Romania:"ro","":""}).value("parties",{PPE:{logo:"https://upload.wikimedia.org/wikipedia/en/8/80/EPP_EP_group_logo_2015.png",color:"black"},"Verts/ALE":{logo:"https://upload.wikimedia.org/wikipedia/fr/thumb/e/e9/Logo_Verts_ALE_en.png/300px-Logo_Verts_ALE_en.png",color:"green"},ALDE:{logo:"https://upload.wikimedia.org/wikipedia/de/2/2d/ALDE_logo.svg",color:"pink"},"S&D":{logo:"https://upload.wikimedia.org/wikipedia/commons/c/c4/Logo_S%26D_EN.png",color:"red"},ECR:{logo:"https://upload.wikimedia.org/wikipedia/en/e/e9/European_Conservatives_and_Reformists_logo.png",color:"purple"},ENF:{logo:"",color:"blue"},EFD:{logo:"",color:"brown"},"GUE/NGL":{logo:"icons/gue_ngl.svg",color:"#ac161e"},"":""}).config(function(e,o){o.otherwise("/votes"),e.state("votes",{url:"/votes",templateUrl:"modules/vote/list.html",controller:"votescontroller"}).state("votesget",{url:"/votes/:voteid",templateUrl:"modules/vote/index.html",controller:function(e,o,t){console.log(t),e.loading=!0,e.selectedIndex=-1,o.get("/api/votes/"+t.voteid).then(function(o){console.log(o),e.voteresult=o.data,e.loading=!1},function(o){console.log(o),e.loading=!1}),e.selectParty=function(o){e.group=o}}}).state("meps",{url:"/meps",templateUrl:"modules/mep/list.html",controller:function(e,o,t,l,s,n){function r(o){e.loading=!0;var l="/api/meps?$skip="+i.skip+"&$limit="+i.limit+"&$sort[Birth.date]=-1&$select[]=Birth&$select[]=Photo&$select[]=Name&$select[]=Groups&$select[]=UserID&$select[]=active"+a+c;t.get(l).then(function(t){o?e.meps.data=e.meps.data.concat(t.data.data):e.meps=t.data,e.loading=!1},function(o){console.log(o),e.loading=!1})}console.log("--------------------meps list---------------");var i={skip:0,limit:20};e.countries=s,e.parties=n,e.selectedCountry=localStorage.getItem("country")||"",e.selectedParty=localStorage.getItem("party")||"";var a="";e.$watch("selectedCountry",function(){localStorage.setItem("country",e.selectedCountry),a=e.selectedCountry?"&Groups.0.country="+e.selectedCountry:"",i.skip=0,console.log("selectedCoutne"),r()});var c="";e.$watch("selectedParty",function(){localStorage.setItem("party",e.selectedParty),c=e.selectedParty?"&Groups.0.groupid="+encodeURIComponent(e.selectedParty):"",i.skip=0,console.log("selectedparty"),r()}),console.log("meeeeps",s),e.loadMore=function(){console.log("give me more data",i.skip,e.meps),i.skip=i.skip+i.limit;var o=i.limit;e.meps&&e.meps.total+i.skip>i.limit&&(o=e.meps.total-i.skip),console.log(o),o>0&&(console.log("load()"),r(!0))}}}).state("mepsget",{url:"/meps/:userid",templateUrl:"modules/mep/index.html",controller:"mepcontroller"}).state("dossiers",{url:"/dossier",templateUrl:"modules/dossier/list.html",controller:"dossierlistcontroller"}).state("dossierget",{url:"/dossier/:dossierid",templateUrl:"modules/dossier/index.html",controller:"dossiercontroller"})}).controller("api",function(e,o){e.test="funkt"}).filter("partylogo",function(e){return function(o){return e[o]?e[o].logo:void 0}}).filter("partycolor",function(e){return function(o){return console.log(o),e[o]?e[o].color:void 0}}).filter("flag",function(e,o){return function(e){return"https://cdn.rawgit.com/lipis/flag-icon-css/master/flags/4x3/"+o[e]+".svg"}}),angular.module("mep",[]).controller("mepcontroller",function(e,o,t,l){function s(o,l){var s=o+".groups.votes.ep_id="+l;console.log(s);var n="$select[]=title&$select[]=eptitle&$select[]=ts&$select[]=voteid&$select[]="+o+".groups.votes.$."+l;t.get("/api/votes/?"+s+"&$limit=10$skip=0&$sort[ts]=-1&"+n).then(function(t){console.log(t.data);for(var l=0;l<t.data.data.length;l++)t.data.data[l].vote=o;e.votings=e.votings.concat(t.data.data),console.log(e.votings)})}var n=["Against","For","Abstain"];e.votings=[],console.log("mepcontroller"),o.loading=!0,t.get("/api/meps/"+l.userid).then(function(t){console.log(t),e.mep=t.data,o.loading=!1},function(e){console.log(e),o.loading=!1}),e.select=function(o){console.log("--day--",o),e.selectedday=o};for(var r=("Against.groups.votes.ep_id="+l.userid,0);r<n.length;r++){var i=n[r];console.log(i),s(i,l.userid)}});